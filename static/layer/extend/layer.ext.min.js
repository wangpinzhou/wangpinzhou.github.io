/**
 
 @Name: layer拓展类，依赖于layer
 @Date: 2014.05.16
 @Author: 贤心
 @Versions：1.3
 @Api：http://sentsin.com/jquery/layer
 @Desc: 本拓展会持续更新

 **/
layer.use("skin/layer.ext.css",function(){layer.ext&&layer.ext()});layer.extv="1.3";layer.prompt=function(b,a,e){var c={};b=b||{};e={area:["auto","auto"],offset:[b.top||"200px",""],title:b.title||"\u4fe1\u606f",dialog:{btns:2,type:-1,msg:'\x3cinput type\x3d"'+(1===b.type?"password":2===b.type?"file":"text")+'" class\x3d"xubox_prompt xubox_form" id\x3d"xubox_prompt" value\x3d"" /\x3e',yes:function(g){var f=c.prompt.val();""===f?c.prompt.focus():f.replace(/\s/g,"").length>(b.length||1E3)?layer.tips("\u6700\u591a\u8f93\u5165"+(b.length||1E3)+"\u4e2a\u5b57\u6570","#xubox_prompt",2):(layer.close(g),a&&a(f))},no:e},success:function(){c.prompt=$("#xubox_prompt")}};3===b.type&&(e.dialog.msg='\x3ctextarea class\x3d"xubox_prompt xubox_form xubox_formArea" id\x3d"xubox_prompt"\x3e\x3c/textarea\x3e');return $.layer(e)};layer.tab=function(b){b=b||{};var a=b.data||[],e=b.shade,c=b.offset;b.area=b.area||[];b={type:1,border:[0],area:["auto","auto"],title:!1,shade:e,offset:c,move:".xubox_tabmove",closeBtn:!1,page:{html:'\x3cdiv class\x3d"xubox_tab" style\x3d"'+("width:"+(b.area[0]||"500px")+"; height:"+(b.area[1]||"300px")+'"\x3e')+'\x3cspan class\x3d"xubox_tabmove"\x3e\x3c/span\x3e\x3cdiv class\x3d"xubox_tabtit"\x3e'+function(){var b=a.length,f=1,c="";if(0<b)for(c='\x3cspan class\x3d"xubox_tabnow"\x3e'+a[0].title+"\x3c/span\x3e";f<b;f++)c+="\x3cspan\x3e"+a[f].title+"\x3c/span\x3e";return c}()+'\x3c/div\x3e\x3cul class\x3d"xubox_tab_main"\x3e'+function(){var b=a.length,c=1,e="";if(0<b)for(e='\x3cli class\x3d"xubox_tabli xubox_tab_layer"\x3e'+(a[0].content||"content\u672a\u4f20\u5165")+"\x3c/li\x3e";c<b;c++)e+='\x3cli class\x3d"xubox_tabli"\x3e'+(a[c].content||"content\u672a\u4f20\u5165")+"\x3c/li\x3e";return e}()+'\x3c/ul\x3e\x3cspan class\x3d"xubox_tabclose" title\x3d"\u5173\u95ed"\x3eX\x3c/span\x3e\x3c/div\x3e'},success:function(a){var b=$(".xubox_tabtit").children(),c=$(".xubox_tab_main").children(),e=$(".xubox_tabclose");b.on("click",function(){var a=$(this),b=a.index();a.addClass("xubox_tabnow").siblings().removeClass("xubox_tabnow");c.eq(b).show().siblings().hide()});e.on("click",function(){layer.close(a.attr("times"))})}};return $.layer(b)};layer.photos=function(b){b=b||{};var a={imgIndex:1,end:null,html:$("html")},e=$(window),c=b.json,g=b.page;if(c){var f=c.data;if(1===c.status)if(a.imgLen=f.length,0<f.length)a.thissrc=f[c.start].src,a.pid=f[c.start].pid,a.imgsname=c.title||"",a.name=f[c.start].name,a.imgIndex=c.start+1;else{layer.msg("\u6ca1\u6709\u4efb\u4f55\u56fe\u7247",2,8);return}else{layer.msg("\u672a\u8bf7\u6c42\u5230\u6570\u636e",2,8);return}}else{var m=$(g.parent).find("img"),k=m.eq(g.start);a.thissrc=k.attr("layer-img")||k.attr("src");a.pid=k.attr("pid");a.imgLen=m.length;a.imgsname=g.title||"";a.name=k.attr("layer-pname");a.imgIndex=g.start+1}var k=[(b.html?915:600)+"px","auto"],n='\x3cdiv class\x3d"xubox_bigimg"\x3e\x3cimg src\x3d"'+a.thissrc+'" alt\x3d"'+(a.name||"")+'" layer-pid\x3d"'+(a.pid||"")+'"\x3e\x3cdiv class\x3d"xubox_imgsee"\x3e',l;l=1<a.imgLen?'\x3ca href\x3d"" class\x3d"xubox_iconext xubox_prev"\x3e\x3c/a\x3e\x3ca href\x3d"" class\x3d"xubox_iconext xubox_next"\x3e\x3c/a\x3e':"";n=n+l+'\x3cdiv class\x3d"xubox_imgbar"\x3e\x3cspan class\x3d"xubox_imgtit"\x3e\x3ca href\x3d"javascript:;"\x3e'+a.imgsname+" \x3c/a\x3e\x3cem\x3e"+a.imgIndex+"/"+a.imgLen+"\x3c/em\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e";l=b.html?'\x3cdiv class\x3d"xubox_intro"\x3e'+b.html+"\x3c/div\x3e":"";var h={type:1,border:[0],area:k,title:!1,shade:[.9,"#000",!0],shadeClose:!0,offset:["25px",""],bgcolor:"",page:{html:n+l},success:function(e){a.bigimg=e.find(".xubox_bigimg");a.imgsee=a.bigimg.find(".xubox_imgsee");a.imgbar=a.imgsee.find(".xubox_imgbar");a.imgtit=a.imgbar.find(".xubox_imgtit");a.layero=e;var p=a.imgs=a.bigimg.find("img");clearTimeout(a.timerr);a.timerr=setTimeout(function(){$("html").css("overflow","hidden").attr("layer-full",a.index)},10);p.load(function(){a.imgarea=[p.outerWidth(),p.outerHeight()];a.resize(e);b.success&&b.success(c||g)});a.event()},end:function(){layer.closeAll();a.end=!0}};a.event=function(){a.bigimg.hover(function(){a.imgsee.show()},function(){a.imgsee.hide()});h.imgprev=function(){a.imgIndex--;1>a.imgIndex&&(a.imgIndex=a.imgLen);a.tabimg()};a.bigimg.find(".xubox_prev").on("click",function(a){a.preventDefault();h.imgprev()});h.imgnext=function(){a.imgIndex++;a.imgIndex>a.imgLen&&(a.imgIndex=1);a.tabimg()};a.bigimg.find(".xubox_next").on("click",function(a){a.preventDefault();h.imgnext()});$(document).keyup(function(b){if(!a.end){var c=b.keyCode;b.preventDefault();37===c?h.imgprev():39===c?h.imgnext():27===c&&layer.close(a.index)}});a.tabimg=function(){var b,e,d;a.imgs.removeAttr("style");c?(d=f[a.imgIndex-1],b=d.src,e=d.pid,d=d.name):(d=m.eq(a.imgIndex-1),b=d.attr("layer-img")||d.attr("src"),e=d.attr("layer-pid")||"",d=d.attr("layer-pname")||"");a.imgs.attr({src:b,"layer-pid":e,alt:d});a.imgtit.find("em").text(a.imgIndex+"/"+a.imgLen);a.imgsee.show()}};a.resize=function(c){var f,d=[e.width(),e.height()];f=d[0]-d[0]/d[1]*(60*d[0]/d[1]);600>f&&(f=600);d=[f,400<d[1]?d[1]-50:400];d[0]=b.html?d[0]:d[0]-300;layer.area(a.index,{width:d[0]+(b.html?15:0),height:d[1]});f=d[0]-(b.html?300:0);a.imgarea[0]>f?a.imgs.css({width:f}):a.imgs.css({width:a.imgarea[0]});a.imgs.outerHeight()<d[1]&&a.imgs.css({top:(d[1]-a.imgs.outerHeight())/2});a.imgs.css({visibility:"visible"});a.bigimg.css({width:f,height:d[1],"background-color":b.bgcolor});b.html&&c.find(".xubox_intro").css({height:d[1]})};e.on("resize",function(){a.end||(a.timer&&clearTimeout(a.timer),a.timer=setTimeout(function(){a.resize(a.layero)},200))});a.index=$.layer(h);return a.index};layer.photosPage=function(b){var a={run:function(a){layer.photos({html:b.html,success:b.success,page:{title:b.title,id:b.id,start:a,parent:b.parent}})}};b=b||{};$(b.parent).find("img").each(function(b){$(this).on("click",function(){a.run(b)})})};